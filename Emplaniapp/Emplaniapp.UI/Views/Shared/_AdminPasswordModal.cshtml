<!-- Modal de Confirmaci√≥n de Contrase√±a de Administrador -->
<div class="modal fade" id="adminPasswordModal" tabindex="-1" role="dialog" aria-labelledby="adminPasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="adminPasswordModalLabel">Confirmaci√≥n de Administrador Requerida</h5>
                <button type="button" class="close" id="adminPasswordModalClose" aria-label="Cerrar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Para guardar estos cambios, por favor ingrese su contrase√±a de administrador.</p>
                <form id="adminPasswordForm" onsubmit="return false;">
                    <div class="form-group">
                        <label for="adminPasswordInput">Contrase√±a</label>
                        <input type="password" class="form-control" id="adminPasswordInput" placeholder="Contrase√±a">
                        <div id="adminPasswordError" class="text-danger mt-2" style="display: none;"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelAdminPasswordBtn">Cancelar</button>
                <button type="button" class="btn btn-primary" id="confirmAdminPasswordBtn">Confirmar y Guardar</button>
            </div>
        </div>
    </div>
</div>

<script>
// Namespace global para el modal de contrase√±a de administrador
window.AdminPasswordModal = window.AdminPasswordModal || {};

$(document).ready(function() {
    // Solo inicializar una vez
    if (window.AdminPasswordModal.initialized) {
        return;
    }

    // Funci√≥n centralizada para limpiar el modal
    window.AdminPasswordModal.clear = function() {
        $('#adminPasswordInput').val('');
        $('#adminPasswordError').hide().text('');
        console.log('üßπ Modal de contrase√±a limpiado');
    };

    // Funci√≥n centralizada para cerrar el modal
    window.AdminPasswordModal.close = function() {
        $('#adminPasswordModal').modal('hide');
        window.AdminPasswordModal.clear();
        console.log('‚ùå Modal de contrase√±a cerrado');
    };

    // Funci√≥n para mostrar el modal
    window.AdminPasswordModal.show = function() {
        window.AdminPasswordModal.clear();
        $('#adminPasswordModal').modal('show');
        console.log('üëÄ Modal de contrase√±a mostrado');
    };

    // Event handler para el bot√≥n Cancelar (SOLO para cancelar)
    $(document).off('click', '#cancelAdminPasswordBtn').on('click', '#cancelAdminPasswordBtn', function(e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('üö´ Bot√≥n Cancelar clickeado');
        window.AdminPasswordModal.close();
    });

    // Event handler para el bot√≥n X (cerrar)
    $(document).off('click', '#adminPasswordModalClose').on('click', '#adminPasswordModalClose', function(e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('‚ùå Bot√≥n X clickeado');
        window.AdminPasswordModal.close();
    });

    // Event handler para cerrar al presionar Escape
    $(document).off('keydown', '#adminPasswordModal').on('keydown', '#adminPasswordModal', function(e) {
        if (e.keyCode === 27) { // Escape key
            console.log('‚å®Ô∏è Tecla Escape presionada');
            window.AdminPasswordModal.close();
        }
    });

    // Event handler para limpiar cuando se cierra el modal por cualquier medio
    $('#adminPasswordModal').off('hidden.bs.modal.adminPassword').on('hidden.bs.modal.adminPassword', function() {
        window.AdminPasswordModal.clear();
        console.log('üîÑ Modal cerrado - campos limpiados autom√°ticamente');
    });

    // Event handler para cuando se muestra el modal
    $('#adminPasswordModal').off('shown.bs.modal.adminPassword').on('shown.bs.modal.adminPassword', function() {
        $('#adminPasswordInput').focus();
        console.log('üëÄ Modal de contrase√±a mostrado - foco en input');
    });

    // Permitir env√≠o con Enter
    $(document).off('keypress', '#adminPasswordInput').on('keypress', '#adminPasswordInput', function(e) {
        if (e.which === 13) { // Enter key
            $('#confirmAdminPasswordBtn').click();
        }
    });

    // Prevenir cierre accidental al hacer clic en el backdrop
    $('#adminPasswordModal').off('click.adminPassword').on('click.adminPassword', function(e) {
        if (e.target === this) {
            console.log('üö´ Click en backdrop interceptado - modal no se cierra autom√°ticamente');
            // No cerrar autom√°ticamente, el usuario debe usar Cancelar o X
        }
    });

    window.AdminPasswordModal.initialized = true;
    console.log('‚úÖ Event handlers del modal de contrase√±a inicializados correctamente');
});
</script> 