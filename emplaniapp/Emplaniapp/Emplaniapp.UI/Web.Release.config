<?xml version="1.0"?>
<configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform">

  <!-- 🔎 Mostrar el error real en Azure (SOLO mientras diagnosticamos) -->
  <system.web>
    <!-- Fuerza debug en Release -->
    <compilation debug="true" xdt:Transform="SetAttributes(debug)" />
    <!-- Desactiva customErrors para ver la excepción real -->
    <customErrors mode="Off" xdt:Transform="Replace" />
  </system.web>

  <system.webServer>
    <!-- Evita que IIS reemplace la respuesta de ASP.NET -->
    <httpErrors existingResponse="PassThrough" errorMode="Detailed" xdt:Transform="Replace" />
    <asp scriptErrorSentToBrowser="true" xdt:Transform="InsertIfMissing" />
  </system.webServer>

  <!-- ✅ (Opcional pero recomendable) Forzar cadenas de conexión en Release -->
  <connectionStrings>
    <add name="EmplaniappDb"
         connectionString="Server=tcp:emplaniappserver.database.windows.net,1433;Initial Catalog=emplaniappBD;User ID=EmplaniAppUser;Password=EmplaniappPass123@;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;"
         providerName="System.Data.SqlClient"
         xdt:Transform="SetAttributes" xdt:Locator="Match(name)" />
    <!-- Alias si el código usa DefaultConnection -->
    <add name="DefaultConnection"
         connectionString="Server=tcp:emplaniappserver.database.windows.net,1433;Initial Catalog=emplaniappBD;User ID=EmplaniAppUser;Password=EmplaniappPass123@;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;"
         providerName="System.Data.SqlClient"
         xdt:Transform="SetAttributes" xdt:Locator="Match(name)" />
  </connectionStrings>

  <!-- 🏷️ Bandera para confirmar que el transform se aplicó -->
  <appSettings>
    <add key="TRANSFORM_APPLIED" value="TRUE" xdt:Transform="InsertIfMissing" />
  </appSettings>
</configuration>
