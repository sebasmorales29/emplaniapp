@model Emplaniapp.UI.Models.ResetPasswordViewModel
@{
    ViewBag.Title = "Restablecer contraseña";
    Layout = "~/Views/Shared/_LoginLayout.cshtml";
}

<div class="sign-user_card bg-white text-center p-4">
    <!-- Logo -->
    <div class="mb-3">
        <img src="~/Content/Images/Emplaniapp_Logo1.png" alt="Emplaniapp" style="max-height:80px;">
    </div>

    <h3 class="mb-2">Restablecer contraseña</h3>
    <p class="text-secondary mb-4">Cree una nueva contraseña para su cuenta</p>

    @using (Html.BeginForm("ResetPassword", "Account", FormMethod.Post, new { id = "resetForm", novalidate = "novalidate" }))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "validation-summary advertencia text-start" })

        @Html.HiddenFor(m => m.UserId)
        @Html.HiddenFor(m => m.Code)

        <div class="mb-3 text-start">
            @Html.LabelFor(m => m.Password, new { @class = "form-label text-secondary" })
            @Html.PasswordFor(m => m.Password, new
            {
                @class = "form-control text-center",
                required = "required",
                autocomplete = "new-password",
                id = "Password"
            })
            @Html.ValidationMessageFor(m => m.Password, "", new { @class = "advertencia" })
        </div>

        <div class="mb-3 text-start">
            @Html.LabelFor(m => m.ConfirmPassword, new { @class = "form-label text-secondary" })
            @Html.PasswordFor(m => m.ConfirmPassword, new
            {
                @class = "form-control text-center",
                required = "required",
                autocomplete = "new-password",
                id = "ConfirmPassword"
            })
            @Html.ValidationMessageFor(m => m.ConfirmPassword, "", new { @class = "advertencia" })
        </div>

        <button type="submit" class="btn btn-primary w-100" id="resetBtn">Guardar contraseña</button>
    }

    <div class="mt-4">
        <a href="@Url.Action("Login","Account")">Iniciar sesión</a>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        (function () {
            // Toggle mostrar/ocultar contraseña (si usas botones "ojo", deja estos ids en tu HTML)
            var $toggle1 = $('#togglePassword1');
            var $toggle2 = $('#togglePassword2');
            var $pass = $('#Password');
            var $conf = $('#ConfirmPassword');

            if ($toggle1.length && $pass.length) {
                $toggle1.on('click', function () {
                    if ($pass.attr('type') === 'password') { $pass.attr('type', 'text'); $('#eyeIcon1').addClass('closed'); }
                    else { $pass.attr('type', 'password'); $('#eyeIcon1').removeClass('closed'); }
                });
            }
            if ($toggle2.length && $conf.length) {
                $toggle2.on('click', function () {
                    if ($conf.attr('type') === 'password') { $conf.attr('type', 'text'); $('#eyeIcon2').addClass('closed'); }
                    else { $conf.attr('type', 'password'); $('#eyeIcon2').removeClass('closed'); }
                });
            }

            // Loading state del botón
            var $form = $('#resetForm');
            var $btn = $('#resetBtn');
            if ($form.length && $btn.length) {
                $form.on('submit', function () {
                    $btn.addClass('btn-loading').prop('disabled', true);
                    setTimeout(function () {
                        if ($('.field-validation-error:visible').length > 0 || $('.validation-summary:visible').length > 0) {
                            $btn.removeClass('btn-loading').prop('disabled', false);
                        }
                    }, 120);
                });
            }
        })();
    </script>
}

