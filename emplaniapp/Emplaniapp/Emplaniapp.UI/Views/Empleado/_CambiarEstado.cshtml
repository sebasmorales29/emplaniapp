@model Emplaniapp.Abstracciones.ModelosParaUI.EmpleadoDto

@{
    ViewBag.Title = "Cambiar Estado de Empleado";
}

@*<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />*@
<link rel="stylesheet" href="../assets/css/backend-plugin.min.css">
<link rel="stylesheet" href="../assets/css/backend.css?v=1.0.0">


<div class="container d-flex justify-content-center mt-4">
    <div style="max-width: 700px; width: 100%;">
        <!-- Cabecera -->
        <div class="row modal-header">
            <h4 class="modal-title text-center mb-2">Cambiar Estado de Empleado</h4>
        </div>

        <!-- Información del empleado -->
        <div class="row card mb-4 border-0 shadow-lg">
            <div class="card-header bg-light text-center fw-bold">
                <h5>Información del Empleado</h5>
            </div>
            <div class="card-body text-center">
                <dl class="row justify-content-center">
                    <dt class="col-sm-4 text-end">Nombre Completo:</dt>
                    <dd class="col-sm-6 text-start">@Model.nombre @Model.segundoNombre @Model.primerApellido @Model.segundoApellido</dd>

                    <dt class="col-sm-4 text-end">Cédula:</dt>
                    <dd class="col-sm-6 text-start">@Model.cedula</dd>

                    <dt class="col-sm-4 text-end">Cargo:</dt>
                    <dd class="col-sm-6 text-start">@Model.nombreCargo</dd>

                    <dt class="col-sm-4 text-end">Estado Actual:</dt>
                    <dd class="col-sm-6 text-start">
                        <span class="badge @(Model.idEstado == 1 ? "bg-success-light" : Model.idEstado == 2 ? "bg-danger-light" : "bg-warning-light")">
                            @Model.nombreEstado
                        </span>
                    </dd>
                </dl>
            </div>
        </div>

        <!-- Formulario POST -->
        @using (Html.BeginForm("_CambiarEstado", "Empleado", FormMethod.Post))
        {
            @Html.Hidden("id", Model.idEmpleado)

            <div class="row card mb-4 border-0 shadow-lg">
                <div class="card-header bg-primary-light text-center fw-bold">
                    <h5>Seleccionar Nuevo Estado</h5>
                </div>
                <div class="card-body d-flex flex-column align-items-center">
                    <div class="row form-group mb-4" style="width: 300px;">
                        <label for="idEstado" class="form-label text-center w-100">Nuevo Estado:</label>
                        @Html.DropDownList("idEstado", ViewBag.Estados as IEnumerable<SelectListItem>, "Seleccione un estado", new { @class = "form-control text-center" })
                    </div>

                    <div class="d-flex justify-content-center align-items-center">
                        <button type="button" class="btn btn-outline-secondary m-2"
                                id="cancelarBtn" data-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary m-2">
                            Cambiar Estado
                        </button>
                    </div>

                </div>
            </div>
        }

    </div>
</div>



<script>
    $(document).ready(function () {
        // Para cerrar
        $('#cancelarBtn').click(function () {
            $('#modalCambiarEstado').modal('hide');
        });

        // ✨ NUEVO: Validación antes de enviar el formulario
        $('form').on('submit', function (e) {
            var estadoSeleccionado = $('#idEstado').val();
            console.log('🔍 DIAGNÓSTICO: Estado seleccionado:', estadoSeleccionado);
            
            if (!estadoSeleccionado || estadoSeleccionado === '' || estadoSeleccionado === '0') {
                e.preventDefault(); // Prevenir envío
                console.log('🔍 DIAGNÓSTICO: Estado no válido, mostrando error');
                
                // Mostrar mensaje de error
                var errorHtml = '<div class="alert alert-warning alert-dismissible fade show" role="alert" style="margin-top: 15px;">' +
                    '<i class="bi bi-exclamation-triangle-fill me-2"></i>' +
                    '<strong>Advertencia:</strong> Por favor seleccione un estado válido antes de continuar.' +
                    '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>' +
                    '</div>';
                
                // Remover mensajes de error anteriores
                $('.alert').remove();
                
                // Agregar mensaje de error
                $('.card-body').prepend(errorHtml);
                
                // Resaltar el dropdown
                $('#idEstado').addClass('is-invalid');
                
                // Quitar resaltado después de 3 segundos
                setTimeout(function() {
                    $('#idEstado').removeClass('is-invalid');
                }, 3000);
                
                return false;
            }
            
            console.log('🔍 DIAGNÓSTICO: Estado válido, enviando formulario');
            return true;
        });
        
        // ✨ NUEVO: Limpiar mensajes de error cuando se cambia la selección
        $('#idEstado').on('change', function() {
            $('.alert').remove();
            $(this).removeClass('is-invalid');
        });
    });
</script>

<!-- ✨ NUEVO: Estilos para validación -->
<style>
    .is-invalid {
        border-color: #dc3545 !important;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
    }
    
    .alert {
        border-radius: 8px;
        border: none;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .alert-warning {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        color: #856404;
        border-left: 4px solid #ffc107;
    }
    
    .btn-close {
        background: none;
        border: none;
        font-size: 1.2em;
        opacity: 0.7;
    }
    
    .btn-close:hover {
        opacity: 1;
    }
</style>